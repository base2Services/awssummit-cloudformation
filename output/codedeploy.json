{"AWSTemplateFormatVersion":"2010-09-09","Parameters":{"EnvironmentName":{"Type":"String"}},"Resources":{"CodeDeployRole":{"Type":"AWS::IAM::Role","Properties":{"AssumeRolePolicyDocument":{"Statement":[{"Effect":"Allow","Principal":{"Service":["codedeploy.us-east-1.amazonaws.com","codedeploy.us-west-2.amazonaws.com","codedeploy.eu-west-1.amazonaws.com","codedeploy.ap-southeast-2.amazonaws.com"]},"Action":["sts:AssumeRole"]}]},"Path":"/","Policies":[{"PolicyName":"CodeDeployRole","PolicyDocument":{"Statement":[{"Effect":"Allow","Action":["autoscaling:CompleteLifecycleAction","autoscaling:DeleteLifecycleHook","autoscaling:DescribeAutoScalingGroups","autoscaling:DescribeLifecycleHooks","autoscaling:PutLifecycleHook","autoscaling:RecordLifecycleActionHeartbeat","ec2:DescribeInstances","ec2:DescribeInstanceStatus","tag:GetTags","tag:GetResources"],"Resource":"*"}]}}]}},"awssummit-demoCodeDeployApplication":{"Type":"AWS::CodeDeploy::Application","Properties":{"ApplicationName":{"Fn::Join":["",[{"Ref":"EnvironmentName"},"-awssummit-demo"]]}}},"appDeploymentGroup":{"Type":"AWS::CodeDeploy::DeploymentGroup","Properties":{"DeploymentGroupName":{"Fn::Join":["",[{"Ref":"EnvironmentName"},"-app"]]},"ApplicationName":{"Ref":"awssummit-demoCodeDeployApplication"},"DeploymentConfigName":"CodeDeployDefault.OneAtATime","Ec2TagFilters":[{"Key":"Name","Value":{"Fn::Join":["",[{"Ref":"EnvironmentName"},"-app-xx"]]},"Type":"KEY_AND_VALUE"}],"ServiceRoleArn":{"Fn::GetAtt":["CodeDeployRole","Arn"]}}}}}
